
MACHINE ??= "raspberrypi3"
DL_DIR ?= "${TOPDIR}/downloads"
SSTATE_DIR ?= "${TOPDIR}/sstate-cache"
TMPDIR = "${TOPDIR}/tmp"

DISTRO ?= "poky"
PACKAGE_CLASSES ?= "package_ipk"
EXTRA_IMAGE_FEATURES ?= "debug-tweaks"
USER_CLASSES ?= "buildstats image-mklibs image-prelink"
PATCHRESOLVE = "user"

BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    ABORT,${TMPDIR},100M,1K \
    ABORT,${DL_DIR},100M,1K \
    ABORT,${SSTATE_DIR},100M,1K \
    ABORT,/tmp,10M,1K"

BB_NUMBER_THREADS ?= "${@oe.utils.cpu_count()}"
PARALLEL_MAKE ?= "-j ${@oe.utils.cpu_count()}"

# Mender storage configuration
#
# More details on these variables is available at
# https://docs.mender.io/devices/yocto-project/partition-configuration#configuring-storage
#
# Also, please be sure to check other config files as other
# layers, config fragments, etc may attempt to set values
# for specific platforms. Using "bitbake -e <image-name>"
# can help determine which files are setting these values
# in a given configuration.
#
#MENDER_STORAGE_TOTAL_SIZE_MB = "14768"
#MENDER_STORAGE_DEVICE = "/dev/mmcblk0"
MENDER_BOOT_PART_SIZE_MB = "40"
#MENDER_DATA_PART_SIZE_MB = "2048"
#MENDER_BOOT_PART = "${MENDER_STORAGE_DEVICE_BASE}1"
#MENDER_DATA_PART = "${MENDER_STORAGE_DEVICE_BASE}4"
#MENDER_ROOTFS_PART_A = "${MENDER_STORAGE_DEVICE_BASE}2"
#MENDER_ROOTFS_PART_B = "${MENDER_STORAGE_DEVICE_BASE}3"
MENDER_ARTIFACT_NAME = "${BUILD_TAG}"

# Appended fragment from meta-mender-community/meta-mender-raspberrypi/templates
#RPI_USE_U_BOOT = "1"
IMAGE_INSTALL_append = " kernel-image kernel-devicetree hello-world"
#IMAGE_FSTYPES_remove = " rpi-sdimg"
#IMAGE_FSTYPES = " ext4 rpi-sdimg"
 
#INHERIT = "mender-full"
MENDER_FEATURES_ENABLE_append = " mender-grub mender-client-install mender-image mender-image-sd"
MENDER_FEATURES_DISABLE_append = " mender-systemd"
PACKAGECONFIG_remove = "split-mender-config"

#ENABLE_UART = "1"
#ARTIFACTIMG_FSTYPE = "ext4"

# Enable systemd
#INIT_MANAGER = "systemd"
DISTRO_FEATURES_append = " systemd"
DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
VIRTUAL-RUNTIME_init_manager = "systemd"
VIRTUAL-RUNTIME_initscripts = "systemd-compat-units"

# Select device tree .dtb file so that u-boot doesn't get confused
KERNEL_DEVICETREE = "bcm2710-rpi-3-b.dtb"

BUILD_TAG = "recovery-rpi3-2908-dunfell"

CONF_VERSION = "1"
